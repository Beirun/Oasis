@page "/bookings"
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject ReservationServices ReservationService
@inject UserState UserState
@using Oasis.State
@using Oasis.Data.Object
@using Oasis.Data.Models
@using Oasis.Library

<div class="w-full bg-[#F5F5F5] font-montserrat">
	<GuestNavbar />
	<div class="flex flex-col justify-between mt-10 px-60 pb-10">
		<p class="w-full font-bold text-2xl z-1	">My Booking</p>
		@foreach(var booking in guestBookings)
		{
			if (booking.rsv_status == "Checked Out") continue;
			Console.WriteLine(booking.payment_amount);
			<div class="w-full flex flex-row justify-center z-1">
				<div class="w-2/3 h-100 rounded-2xl bg-[url('/standard/standard-1.jpg')] bg-cover"></div>
				<div class="w-1/3 h-100 rounded-2xl bg-white p-10 border border-gray-300 shadow-sm">
					<p class="w-full font-bold text-2xl">@(booking.type_category) Room</p>
					<div class="w-full h-15 flex flex-row justify-between">
						<p>Guest</p>
						<p class="text-gray-400">@(currentUser.user_fname + " " + currentUser.user_lname)</p>
					</div>
					<div class="w-full h-15 flex flex-row justify-between">
						<p>Check In</p>
						<p class="text-gray-400">@(booking.rsv_checkin)</p>
					</div>
					<div class="w-full h-15 flex flex-row justify-between">
						<p>Check Out</p>
						<p class="text-gray-400">@(booking.rsv_checkout)</p>
					</div>
					<div class="w-full h-[1px] bg-gray-300"></div>
					<div class="w-full h-15 flex flex-row justify-between">
						<p>Total Amount</p>
						<p class="text-[#0040A6]">@(booking.payment_amount.ToString("N2"))</p>
					</div>
					<div class="w-full flex flex-col justify-center">
						@if(booking.rsv_status == "Checked In")
						{
							<button class="w-3/4 h-10 rounded-2xl bg-[#2563EB] text-white cursor-pointer">Extend</button>

						}
						else
						{
							<button class="text-[#8C96A6] cursor-pointer">Cancel</button>
							
						}
					</div>
				</div>
			</div>
		}
		@if(guestBookings.Where(r => r.rsv_status == "Checked Out" || r.rsv_status == "Cancelled").Count() > 0)
		{
			
		
		<div class="w-full bg-white rounded-2xl px-10 pb-10 mb-5  border border-gray-300 shadow-sm  z-1">
			<div class="w-full h-20 flex flex-col justify-center"><p class="w-full font-bold text-2xl">History</p></div>
			<table class="w-full">
				<thead>
					<tr class="text-center text-[#6B7280] h-10 bg-gray-100">
						<td>Room</td>
						<td>Room Type</td>
						<td>Check In</td>
						<td>Check Out</td>
						<td>Amount</td>
					</tr>
				</thead>
				@for (int i = 0; i < 5; i++)
				{
					<tr class="text-center h-15 border-b border-gray-300">
						<td>215</td>
						<td>Suite</td>
						<td>Check In</td>
						<td>Check Out</td>
						<td>Amount</td>
					</tr>
				}
			</table>
		</div>
		}
	</div>

	<div style="clip-path: polygon(0 0, 0 26%, 25% 0);" class="w-full h-full bg-primary z-0 fixed top-0"></div>
	<div style="clip-path: polygon(100% 0, 100% 26%, 75% 0);" class="w-full h-full bg-primary z-0 fixed top-0"></div>
	<div style="clip-path: polygon(0 74%, 0 100%, 26% 100%);" class="w-full h-full bg-primary z-0 fixed top-0"></div>
	<div style="clip-path: polygon(100% 75%, 100% 100%, 75% 100%);" class="w-full h-full bg-primary z-0 fixed top-0"></div>
</div>

@code {
	private List<GuestBooking> guestBookings = new List<GuestBooking>();
	private User currentUser = new User();
	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			await UserState.LoadUserAsync();
			if (UserState.CurrentUser == null)
            {
                NavigationManager.NavigateTo("/signin");
            }
            else
            {
                currentUser = UserState.CurrentUser;
                guestBookings = await ReservationService.GetReservationsByGuestId(currentUser.user_id);
				Console.WriteLine(System.Text.Json.JsonSerializer.Serialize(guestBookings));
            }
			StateHasChanged();
		}
	}

}

@page "/profile/housekeeper"
@rendermode InteractiveServer
@using Oasis.State
@inject AppState AppState
@using Oasis.Data.Models
@using Oasis.Components.ui

<div class="relative mx-auto h-screen w-screen overflow-hidden bg-[#F5F5F5] font-montserrat">
    <Navbar />

    <div class="w-full h-9/10 flex justify-center">
        <div class="w-3/5 h-3/4 bg-white shadow z-1 rounded-lg flex flex-row">
            <div class="w-1/3 h-full flex flex-col pt-12 pl-20">
                <p class="text-2xl font-bold">Account Settings</p>
                <div class="h-50 aspect-square rounded-full bg-[url('/clouds.png')] bg-cover"></div>
                @if (editProfile)
                {
                    <button @onclick='()=>EditProfile("cancel")' class="h-10 text-center text-red-500 font-semibold cursor-pointer">Cancel</button>
                }
                else
                {
                    <button @onclick='()=>EditProfile("edit")' class="w-3/4 h-10 bg-[#2563EB] text-center rounded-lg text-white font-semibold cursor-pointer">Edit Profile</button>
                }
            </div>

            <div class="w-2/3 h-full flex flex-col pt-12">
                <p class="w-2/3 text-2xl font-bold">Basic Info</p>
                <div class="w-2/3 ">
                    <table class="w-full">
                        <tr>
                            <td class="w-1/3 h-10">Firstname</td>
                            <td class="w-2/3 border-b">
                                <input class="w-full focus:outline-none border-none @(editProfile ? "text-gray-800" : "text-gray-400")"
                                       @bind="currentUser.user_fname"
                                       disabled="@(!editProfile)" />
                            </td>
                        </tr>
                        <tr>
                            <td class="w-1/3 h-10">Lastname</td>
                            <td class="w-2/3 border-b">
                                <input class="w-full focus:outline-none border-none @(editProfile ? "text-gray-800" : "text-gray-400")"
                                       @bind="currentUser.user_lname"
                                       disabled="@(!editProfile)" />
                            </td>
                        </tr>
                        <tr>
                            <td class="w-1/3  h-10 ">Date of Birth</td>
                            <td class="w-2/3">
                                <div class="@(editProfile ? "":"pointer-events-none")">

                                    <CustomDatePicker @bind-Value="currentUser.user_dob" class="w-full cursor-pointer" Id="1" />
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="w-1/3 h-10">Gender</td>
                            <td class="w-2/3 border-b">
                                <input class="w-full focus:outline-none border-none @(editProfile ? "text-gray-800" : "text-gray-400")"
                                       @bind="currentUser.user_gender"
                                       disabled="@(!editProfile)" />
                            </td>
                        </tr>
                    </table>
                </div>
                <p class="w-2/3 text-2xl font-bold mt-5">Account Info</p>
                <div class="w-2/3 ">
                    <table class="w-full">
                        <tr>
                            <td class="w-1/3 h-10">Email</td>
                            <td class="w-2/3 border-b">
                                <input class="w-full focus:outline-none border-none @(editProfile ? "text-gray-800" : "text-gray-400")"
                                       @bind="currentUser.user_email"
                                       disabled="@(!editProfile)" />
                            </td>
                        </tr>
                        <tr>
                            <td class="w-1/3  h-10 ">Password</td>
                            <td class="w-full border-b flex h-10">
                                <input type="@(seePassword ? "text":"password")" class="w-full focus:outline-none border-none @(editProfile ? "text-gray-800" : "text-gray-400")"
                                       @bind="currentUser.user_password"
                                       disabled="@(!editProfile)" />
                                @if (seePassword)
                                {
                                    <Icon onclick="ToggleVisibility" Name="visibility" Size="20px" Color="@(editProfile ? "black":"gray")" />
                                }
                                else
                                {
                                    <Icon onclick="ToggleVisibility" Name="visibility_off" Size="20px" Color="@(editProfile ? "black":"gray")" />
                                }
                            </td>
                        </tr>
                    </table>
                </div>
                @if (editProfile)
                {
                    <div class="w-3/4 px-5">
                        <button class="w-1/4 h-10 bg-[#2563EB] mt-5 text-center rounded-lg text-white font-semibold cursor-pointer">Save</button>
                    </div>
                }
            </div>
        </div>
    </div>
    <div style="clip-path: polygon(40% 100%, 100% 70%, 100% 100%)" class="w-full h-full bg-[#2563EB] z-0 fixed top-0"></div>
    <div style="clip-path: polygon(0 100%, 0 60%, 75% 100%)" class="w-full h-full bg-primary z-0 fixed top-0"></div>
</div>

@code {
    private bool editProfile = false;
    private User currentUser = new User();
    private User originalUser = new User();
    private bool seePassword = false;

    private void EditProfile(string action)
    {
        if (action == "cancel")
        {
            seePassword = false;
            currentUser = new User
                {
                    user_fname = originalUser.user_fname,
                    user_lname = originalUser.user_lname,
                    user_dob = originalUser.user_dob,
                    user_gender = originalUser.user_gender,
                    user_email = originalUser.user_email,
                    user_password = originalUser.user_password
                };
        }
        editProfile = !editProfile;
        StateHasChanged();
    }

    private void ToggleVisibility()
    {
        if (editProfile)
        {
            seePassword = !seePassword;
        }
    }

    protected override async Task OnInitializedAsync()
    {
        currentUser = AppState.CurrentUser;
        originalUser = new User
            {
                user_fname = AppState.CurrentUser.user_fname,
                user_lname = AppState.CurrentUser.user_lname,
                user_dob = AppState.CurrentUser.user_dob,
                user_gender = AppState.CurrentUser.user_gender,
                user_email = AppState.CurrentUser.user_email,
                user_password = AppState.CurrentUser.user_password
            };
    }
}
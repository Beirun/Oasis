@page "/dashboard/housekeeper"
@rendermode InteractiveServer
@using Oasis.Library
@using Oasis.Data.Object
@using Oasis.Data.Models
@inject HouseKeepingServices housekeepingServices
@inject RoomServices roomServices
<div class="bg-background font-montserrat flex h-screen max-w-screen flex-col">
    <Navbar />
    <div class="h-full w-4/5 z-1">

        <div class="mt-3 h-100 flex flex-row">
            <div class="w-3/5 h-full flex flex-col">
                <div class="flex w-full h-25 justify-between">
                    <div class="flex h-full w-1/2 rounded-2xl bg-white shadow-md shadow-gray-300 px-5">
                        <div class=" h-4/5 w-full items-start flex justify-between">
                            <p>Total Rooms Cleaned</p>
                            <p class=" text-3xl font-bold">@(allCleanedRoomsCount)</p>
                            <div class="flex h-15 aspect-square justify-center rounded-full bg-[#D1FAE5]">
                                <Icon Name="check" Size="50px" Color="#059669" />
                            </div>
                        </div>
                    </div>
                    <div class="flex h-full w-1/2 rounded-2xl bg-white shadow-md shadow-gray-300 px-5">
                        <div class=" h-4/5 w-full items-start flex justify-between">
                            <p>Rooms to Clean</p>
                            <p class="text-3xl font-bold">@(roomsToBeCleaned)</p>
                            <div class="bg-[#DBEAFE] p-3 flex justify-center h-15 aspect-square rounded-full">
                                <img src="icons/broom.png" alt="..." class="p-1" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="border-0 h-full w-full h-75 rounded-2xl bg-white p-2">
                    <p class="p-6 text-3xl font-bold">Cleaned Weekly</p>
                </div>

            </div>
            <div class="border-0 box-content h-full w-2/5 rounded-2xl bg-white">
                <p class="p-6 text-3xl font-bold">Rooms Cleaned</p>
            </div>
        </div>
        <div class="mt-3 flex flex-row z-1 mb-5">
            <div class="border-0 box-content w-5/5 rounded-2xl bg-white p-2">
                <p class="p-6 text-3xl font-bold">Recently Cleaned</p>
                <div class="w-full flex justify-center px-6">
                    <table class="w-full">
                        <tr class="w-full text-sm text-gray-400 h-10 bg-gray-200">
                            <td class="w-1/3 text-center">Housekeeper</td>
                            <td class="w-1/5 text-center">Room</td>
                            <td class="w-1/4 text-center">Start Time</td>
                            <td class="w-1/4 text-center">End Time</td>
                        </tr>
                        @if(cleanedRooms.Count() > 0)
                        {

                            @foreach (var cleanRoom in cleanedRooms)
                            {
                                <tr class="w-full border-b border-gray-300">
                                    <td class="flex flex-row w-full px-5 h-15">
                                        <div class="w-full flex flex-row">

                                            <div class="h-10 aspect-square rounded-full bg-[url('/clouds.png')] bg-cover"></div>
                                            <p>@(cleanRoom.user_fname) @(cleanRoom.user_lname)</p>
                                        </div>
                                    </td>
                                    <td class="w-1/5 text-center">@(cleanRoom.room_no)</td>
                                    <td class="w-1/4 text-center">@(cleanRoom.housekeeping_starttime)</td>
                                    <td class="w-1/4 text-center">@(cleanRoom.housekeeping_endtime)</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="4" class=" text-center h-15">No record.</td>
                            </tr>
                        }
                    </table>
                </div>
            </div>
        </div>

    </div>
    <div style="clip-path: polygon(100% 75%, 100% 100%, 30% 100%)" class="w-full h-full bg-[#2563EB] z-0 fixed top-0"></div>
    <div style="clip-path: polygon(0 75%, 0 100%, 75% 100%)" class="w-full h-full bg-primary z-0 fixed top-0"></div>
</div>
@code{
    private List<HouseKeepingRoom> allCleanedRooms = new List<HouseKeepingRoom>();
    private List<HouseKeepingRoom> cleanedRooms = new List<HouseKeepingRoom>();
    private List<Room> toBeCleaned = new List<Room>();
    private int allCleanedRoomsCount = 0;
    private int roomsToBeCleaned = 0;

    protected override async Task OnInitializedAsync()
    {
        allCleanedRoomsCount = (await housekeepingServices.GetRecentlyCleanedRooms()).Count();
        roomsToBeCleaned = await roomServices.GetNumberOfRoomsByStatus("Needs Cleaning");
        cleanedRooms = await housekeepingServices.GetRecentlyCleanedRooms(5);
        Console.WriteLine($"cleaned rooms: {System.Text.Json.JsonSerializer.Serialize(cleanedRooms)}");
    }
}